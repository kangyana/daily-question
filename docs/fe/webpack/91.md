# 【Q091】loader


::: tip Issue
欢迎在 Gtihub Issue 中回答此问题: [Issue 91](https://github.com/kangyana/daily-question/issues/91)
:::

::: tip Author
回答者: [kangyana](https://github.com/kangyana)
:::
## 1. loader
`loader` 用于对 **模块源代码** 进行转换。
`loader` 可以使你在 `import` 或 **加载模块** 时预处理文件。
因此，`loader` 类似于其他构建工具中 `task`，并提供了处理前端构建步骤的得力方式。
`loader` 可以将文件从不同的语言（如 TypeScript）转换为 JavaScript 或将内联图像转换为 `data URL`。
`loader` 甚至允许你直接在 JavaScript 模块中 `import` CSS 文件！

## 2. 示例
例如，你想要加载 CSS 文件、讲TypeScript 转为 JavaScript。
为此，首先安装相对应的 loader：
```bash
npm install --save-dev css-loader ts-loader
```

然后对每个 `.css` 文件 使用 `css-loader`，对每个 `.ts` 文件使用 `ts-loader`：
```javascript
// webpack.config.js
module.exports = {
  module: {
    rules: [
      { test: /\.css$/, use: 'css-loader' },
      { test: /\.ts$/, use: 'ts-loader' },
    ],
  },
};
```

## 3. 使用 loader
`loader` 有两种使用的方式：

- **配置方式**（推荐）：在 `webpack.config.js` 文件中指定 `loader`。
- **内联方式**：在每个 `import` 语句中显式指定 `loader`。

### 配置方式 Configuration
`module.rules` 允许你在 `webpack` 配置中指定多个 `loader`。
这种方式是展示 `loader` 的一种简明方式，并且有助于使代码变得简洁和易于维护。

`loader` 的执行顺序是从上到下。
```javascript
module.exports = {
  module: {
    rules: [
      {
        test: /\.css$/,
        use: [
          // [style-loader](/loaders/style-loader)
          { loader: 'style-loader' },
          // [css-loader](/loaders/css-loader)
          {
            loader: 'css-loader',
            options: {
              modules: true
            }
          },
          // [sass-loader](/loaders/sass-loader)
          { loader: 'sass-loader' }
        ]
      }
    ]
  }
};
```

### 内联方式
可以在 `import` 语句或任何 **与 "import" 方法同等的引用方式** 中指定 `loader`。
使用 `!` 将资源中的 `loader` 分开。每个部分都会相对于当前目录解析。
```javascript
import Styles from 'style-loader!css-loader?modules!./styles.css';
```

通过为内联 `import` 语句添加前缀，可以覆盖 `configuration` 中的所有 `loader`, `preLoader` 和 `postLoader`：

- 使用 `!` 前缀，将禁用所有已配置的 **普通 loader**。
```javascript
import Styles from '!style-loader!css-loader?modules!./styles.css';
```
- 使用 `!!` 前缀，将禁用所有已配置的 `loader`（preLoader, loader, postLoader）。
```javascript
import Styles from '!!style-loader!css-loader?modules!./styles.css';
```
- 使用 `-!` 前缀，将禁用所有已配置的 `preLoader` 和 `loader`，但是不禁用 `postLoaders`。
```javascript
import Styles from '-!style-loader!css-loader?modules!./styles.css';
```

### 注意：尽可能使用 `module.rules`，这样可以减少源码中样板文件的代码量。并且可以在出错时快速定位 `loader` 的问题。
::: tip Author
回答者: [kangyana](https://github.com/kangyana)
:::
## 4. loader 特性
- `loader` 支持链式调用。
- `loader` 支持同步，也支持异步。
- 可以在 `package.json` 的 `main` 指定 npm包 为 `loader`，还可以在 `module.rules` 中使用 `loader` 字段直接引用一个模块。
- `plugin` 可以为 `loader` 带来更多特性。
- `loader` 能够产生额外的文件。

可以通过 `loader` 的预处理函数，进行压缩、打包、编译等功能。

## 5. 解析 loader
`loader` 遵循标准 **模块解析** 规则。
多数情况下，`loader` 将从 **模块路径** 加载（通常是从 npm install, node_modules 进行加载）。

预期 `loader` 模块导出为一个函数，并且编写为 Node.js 兼容的 JavaScript。
通常使用 npm 进行管理 `loader`，但是也可以将应用程序中的文件作为自定义 `loader`。
按照约定，`loader` 通常被命名为 xxx-loader（例如 json-loader）。

## 6. 编写 loader

